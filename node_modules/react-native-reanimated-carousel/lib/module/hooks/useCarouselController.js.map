{"version":3,"sources":["useCarouselController.tsx"],"names":["React","runOnJS","useSharedValue","withSpring","useCarouselController","opts","size","loop","handlerOffsetX","disable","originalLength","length","onChange","index","sharedIndex","useRef","sharedPreIndex","convertToSharedIndex","useCallback","i","computedIndex","current","toInt","value","Math","abs","_sharedIndex","getCurrentIndex","canSliding","onScrollEnd","onScrollBegin","scrollWithSpring","toValue","callback","damping","isFinished","next","currentPage","round","prev","to","idx","animated","offset"],"mappings":"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","sourcesContent":["import React from 'react';\nimport type Animated from 'react-native-reanimated';\nimport { runOnJS, useSharedValue, withSpring } from 'react-native-reanimated';\n\ninterface IOpts {\n    loop: boolean;\n    size: number;\n    handlerOffsetX: Animated.SharedValue<number>;\n    disable?: boolean;\n    onScrollBegin?: () => void;\n    onScrollEnd?: () => void;\n    // the length before fill data\n    originalLength: number;\n    length: number;\n    onChange: (index: number) => void;\n}\n\nexport interface ICarouselController {\n    length: number;\n    index: Animated.SharedValue<number>;\n    sharedIndex: React.MutableRefObject<number>;\n    sharedPreIndex: React.MutableRefObject<number>;\n    prev: () => void;\n    next: () => void;\n    computedIndex: () => void;\n    getCurrentIndex: () => number;\n    to: (index: number, animated?: boolean) => void;\n}\n\nexport function useCarouselController(opts: IOpts): ICarouselController {\n    const {\n        size,\n        loop,\n        handlerOffsetX,\n        disable = false,\n        originalLength,\n        length,\n        onChange,\n    } = opts;\n\n    const index = useSharedValue<number>(0);\n    // The Index displayed to the user\n    const sharedIndex = React.useRef<number>(0);\n    const sharedPreIndex = React.useRef<number>(0);\n\n    const convertToSharedIndex = React.useCallback(\n        (i: number) => {\n            if (loop) {\n                switch (originalLength) {\n                    case 1:\n                        return 0;\n                    case 2:\n                        return i % 2;\n                }\n            }\n            return i;\n        },\n        [originalLength, loop]\n    );\n\n    const computedIndex = React.useCallback(() => {\n        sharedPreIndex.current = sharedIndex.current;\n        const toInt = (handlerOffsetX.value / size) % length;\n        const i =\n            handlerOffsetX.value <= 0\n                ? Math.abs(toInt)\n                : Math.abs(toInt > 0 ? length - toInt : 0);\n        index.value = i;\n        const _sharedIndex = convertToSharedIndex(i);\n        sharedIndex.current = _sharedIndex;\n        onChange(_sharedIndex);\n    }, [\n        length,\n        handlerOffsetX,\n        sharedPreIndex,\n        index,\n        size,\n        sharedIndex,\n        convertToSharedIndex,\n        onChange,\n    ]);\n\n    const getCurrentIndex = React.useCallback(() => {\n        return index.value;\n    }, [index]);\n\n    const canSliding = React.useCallback(() => {\n        return !disable;\n    }, [disable]);\n\n    const onScrollEnd = React.useCallback(() => {\n        opts.onScrollEnd?.();\n    }, [opts]);\n\n    const onScrollBegin = React.useCallback(() => {\n        opts.onScrollBegin?.();\n    }, [opts]);\n\n    const scrollWithSpring = React.useCallback(\n        (toValue: number, callback?: () => void) => {\n            return withSpring(\n                toValue,\n                { damping: 100 },\n                (isFinished: boolean) => {\n                    callback?.();\n                    if (isFinished) {\n                        runOnJS(onScrollEnd)();\n                    }\n                }\n            );\n        },\n        [onScrollEnd]\n    );\n\n    const next = React.useCallback(() => {\n        if (!canSliding() || (!loop && index.value === length - 1)) return;\n\n        onScrollBegin?.();\n\n        const currentPage = Math.round(handlerOffsetX.value / size);\n\n        handlerOffsetX.value = scrollWithSpring((currentPage - 1) * size);\n    }, [\n        canSliding,\n        loop,\n        index.value,\n        length,\n        onScrollBegin,\n        handlerOffsetX,\n        size,\n        scrollWithSpring,\n    ]);\n\n    const prev = React.useCallback(() => {\n        if (!canSliding() || (!loop && index.value === 0)) return;\n\n        onScrollBegin?.();\n\n        const currentPage = Math.round(handlerOffsetX.value / size);\n\n        handlerOffsetX.value = scrollWithSpring((currentPage + 1) * size);\n    }, [\n        canSliding,\n        loop,\n        index.value,\n        onScrollBegin,\n        handlerOffsetX,\n        size,\n        scrollWithSpring,\n    ]);\n\n    const to = React.useCallback(\n        (idx: number, animated: boolean = false) => {\n            if (idx === index.value) return;\n            if (!canSliding()) return;\n\n            onScrollBegin?.();\n\n            const offset = handlerOffsetX.value + (index.value - idx) * size;\n\n            if (animated) {\n                handlerOffsetX.value = scrollWithSpring(offset, () => {\n                    index.value = idx;\n                });\n            } else {\n                handlerOffsetX.value = offset;\n                index.value = idx;\n                runOnJS(onScrollEnd)();\n            }\n        },\n        [\n            index,\n            canSliding,\n            onScrollBegin,\n            handlerOffsetX,\n            size,\n            scrollWithSpring,\n            onScrollEnd,\n        ]\n    );\n\n    return {\n        next,\n        prev,\n        to,\n        index,\n        length,\n        sharedIndex,\n        sharedPreIndex,\n        computedIndex,\n        getCurrentIndex,\n    };\n}\n"]}