{"version":3,"sources":["Carousel.tsx"],"names":["React","Animated","runOnJS","useDerivedValue","useCarouselController","useAutoPlay","usePropsErrorBoundary","ScrollViewGesture","useVisibleRanges","StyleSheet","View","DATA_LENGTH","BaseLayout","useLayoutConfig","useInitProps","CTX","useCommonVariables","useOnProgressChange","Carousel","_props","ref","props","data","loop","mode","style","width","height","vertical","autoPlay","windowSize","autoPlayReverse","autoPlayInterval","renderItem","onScrollEnd","onSnapToItem","onScrollBegin","onProgressChange","customAnimation","commonVariables","size","handlerOffsetX","offsetX","totalSize","length","x","value","isNaN","carouselController","disable","originalLength","_onScrollEnd","onChange","i","next","prev","sharedPreIndex","sharedIndex","computedIndex","getCurrentIndex","run","pause","scrollViewGestureOnScrollBegin","useCallback","current","scrollViewGestureOnScrollEnd","goToIndex","animated","to","useImperativeHandle","visibleRanges","total","viewSize","translation","layoutConfig","renderLayout","item","realIndex","SINGLE_ITEM","DOUBLE_ITEM","animationValue","index","common","styles","container","itemsVertical","itemsHorizontal","map","forwardRef","create","overflow","flexDirection"],"mappings":"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","sourcesContent":["import React, { PropsWithChildren } from 'react';\nimport Animated, { runOnJS, useDerivedValue } from 'react-native-reanimated';\nimport { useCarouselController } from './hooks/useCarouselController';\nimport { useAutoPlay } from './hooks/useAutoPlay';\nimport { usePropsErrorBoundary } from './hooks/usePropsErrorBoundary';\nimport { ScrollViewGesture } from './ScrollViewGesture';\nimport { useVisibleRanges } from './hooks/useVisibleRanges';\nimport type { ICarouselInstance, TCarouselProps } from './types';\nimport { StyleSheet, View } from 'react-native';\nimport { DATA_LENGTH } from './constants';\nimport { BaseLayout } from './layouts/BaseLayout';\nimport { useLayoutConfig } from './hooks/useLayoutConfig';\nimport { useInitProps } from './hooks/useInitProps';\nimport { CTX } from './store';\nimport { useCommonVariables } from './hooks/useCommonVariables';\nimport { useOnProgressChange } from './hooks/useOnProgressChange';\n\nfunction Carousel<T>(\n    _props: PropsWithChildren<TCarouselProps<T>>,\n    ref: React.Ref<ICarouselInstance>\n) {\n    const props = useInitProps(_props);\n\n    const {\n        data,\n        loop,\n        mode,\n        style,\n        width,\n        height,\n        vertical,\n        autoPlay,\n        windowSize,\n        autoPlayReverse,\n        autoPlayInterval,\n        renderItem,\n        onScrollEnd,\n        onSnapToItem,\n        onScrollBegin,\n        onProgressChange,\n        customAnimation,\n    } = props;\n\n    const commonVariables = useCommonVariables(props);\n    const { size, handlerOffsetX } = commonVariables;\n\n    const offsetX = useDerivedValue(() => {\n        const totalSize = size * data.length;\n        const x = handlerOffsetX.value % totalSize;\n\n        if (!loop) {\n            return handlerOffsetX.value;\n        }\n        return isNaN(x) ? 0 : x;\n    }, [loop, size, data]);\n\n    usePropsErrorBoundary(props);\n    useOnProgressChange({ size, offsetX, data, onProgressChange });\n\n    const carouselController = useCarouselController({\n        loop,\n        size,\n        handlerOffsetX,\n        length: data.length,\n        disable: !data.length,\n        originalLength: data.length,\n        onScrollEnd: () => runOnJS(_onScrollEnd)(),\n        onScrollBegin: () => !!onScrollBegin && runOnJS(onScrollBegin)(),\n        onChange: (i) => onSnapToItem && runOnJS(onSnapToItem)(i),\n    });\n\n    const {\n        next,\n        prev,\n        sharedPreIndex,\n        sharedIndex,\n        computedIndex,\n        getCurrentIndex,\n    } = carouselController;\n\n    const { run, pause } = useAutoPlay({\n        autoPlay,\n        autoPlayInterval,\n        autoPlayReverse,\n        carouselController,\n    });\n\n    const scrollViewGestureOnScrollBegin = React.useCallback(() => {\n        pause();\n        onScrollBegin?.();\n    }, [onScrollBegin, pause]);\n\n    const _onScrollEnd = React.useCallback(() => {\n        computedIndex();\n        onScrollEnd?.(sharedPreIndex.current, sharedIndex.current);\n    }, [sharedPreIndex, sharedIndex, computedIndex, onScrollEnd]);\n\n    const scrollViewGestureOnScrollEnd = React.useCallback(() => {\n        run();\n        _onScrollEnd();\n    }, [_onScrollEnd, run]);\n\n    const goToIndex = React.useCallback(\n        (i: number, animated?: boolean) => {\n            carouselController.to(i, animated);\n        },\n        [carouselController]\n    );\n\n    React.useImperativeHandle(\n        ref,\n        () => ({\n            next,\n            prev,\n            getCurrentIndex,\n            goToIndex,\n        }),\n        [getCurrentIndex, goToIndex, next, prev]\n    );\n\n    const visibleRanges = useVisibleRanges({\n        total: data.length,\n        viewSize: size,\n        translation: handlerOffsetX,\n        windowSize,\n    });\n\n    const layoutConfig = useLayoutConfig<T>({ ...props, size });\n\n    const renderLayout = React.useCallback(\n        (item: T, i: number) => {\n            let realIndex = i;\n            if (data.length === DATA_LENGTH.SINGLE_ITEM) {\n                realIndex = i % 1;\n            }\n\n            if (data.length === DATA_LENGTH.DOUBLE_ITEM) {\n                realIndex = i % 2;\n            }\n\n            return (\n                <BaseLayout\n                    key={i}\n                    index={i}\n                    handlerOffsetX={offsetX}\n                    visibleRanges={visibleRanges}\n                    animationStyle={customAnimation || layoutConfig}\n                >\n                    {({ animationValue }) =>\n                        renderItem({\n                            item,\n                            index: realIndex,\n                            animationValue,\n                        })\n                    }\n                </BaseLayout>\n            );\n        },\n        [\n            data,\n            offsetX,\n            visibleRanges,\n            renderItem,\n            layoutConfig,\n            customAnimation,\n        ]\n    );\n\n    return (\n        <CTX.Provider value={{ props, common: commonVariables }}>\n            <View\n                style={[\n                    styles.container,\n                    { width: width || '100%', height: height || '100%' },\n                    style,\n                ]}\n            >\n                <ScrollViewGesture\n                    size={size}\n                    translation={handlerOffsetX}\n                    onScrollBegin={scrollViewGestureOnScrollBegin}\n                    onScrollEnd={scrollViewGestureOnScrollEnd}\n                >\n                    <Animated.View\n                        key={mode}\n                        style={[\n                            styles.container,\n                            {\n                                width: width || '100%',\n                                height: height || '100%',\n                            },\n                            style,\n                            vertical\n                                ? styles.itemsVertical\n                                : styles.itemsHorizontal,\n                        ]}\n                    >\n                        {data.map(renderLayout)}\n                    </Animated.View>\n                </ScrollViewGesture>\n            </View>\n        </CTX.Provider>\n    );\n}\n\nexport default React.forwardRef(Carousel) as typeof Carousel;\n\nconst styles = StyleSheet.create({\n    container: {\n        overflow: 'hidden',\n    },\n    itemsHorizontal: {\n        flexDirection: 'row',\n    },\n    itemsVertical: {\n        flexDirection: 'column',\n    },\n});\n"]}