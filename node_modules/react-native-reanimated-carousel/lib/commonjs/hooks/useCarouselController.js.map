{"version":3,"sources":["useCarouselController.tsx"],"names":["useCarouselController","opts","size","loop","handlerOffsetX","disable","originalLength","length","onChange","index","sharedIndex","React","useRef","sharedPreIndex","convertToSharedIndex","useCallback","i","computedIndex","current","toInt","value","Math","abs","_sharedIndex","getCurrentIndex","canSliding","onScrollEnd","onScrollBegin","scrollWithSpring","toValue","callback","damping","isFinished","next","currentPage","round","prev","to","idx","animated","offset"],"mappings":"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","sourcesContent":["import React from 'react';\nimport type Animated from 'react-native-reanimated';\nimport { runOnJS, useSharedValue, withSpring } from 'react-native-reanimated';\n\ninterface IOpts {\n    loop: boolean;\n    size: number;\n    handlerOffsetX: Animated.SharedValue<number>;\n    disable?: boolean;\n    onScrollBegin?: () => void;\n    onScrollEnd?: () => void;\n    // the length before fill data\n    originalLength: number;\n    length: number;\n    onChange: (index: number) => void;\n}\n\nexport interface ICarouselController {\n    length: number;\n    index: Animated.SharedValue<number>;\n    sharedIndex: React.MutableRefObject<number>;\n    sharedPreIndex: React.MutableRefObject<number>;\n    prev: () => void;\n    next: () => void;\n    computedIndex: () => void;\n    getCurrentIndex: () => number;\n    to: (index: number, animated?: boolean) => void;\n}\n\nexport function useCarouselController(opts: IOpts): ICarouselController {\n    const {\n        size,\n        loop,\n        handlerOffsetX,\n        disable = false,\n        originalLength,\n        length,\n        onChange,\n    } = opts;\n\n    const index = useSharedValue<number>(0);\n    // The Index displayed to the user\n    const sharedIndex = React.useRef<number>(0);\n    const sharedPreIndex = React.useRef<number>(0);\n\n    const convertToSharedIndex = React.useCallback(\n        (i: number) => {\n            if (loop) {\n                switch (originalLength) {\n                    case 1:\n                        return 0;\n                    case 2:\n                        return i % 2;\n                }\n            }\n            return i;\n        },\n        [originalLength, loop]\n    );\n\n    const computedIndex = React.useCallback(() => {\n        sharedPreIndex.current = sharedIndex.current;\n        const toInt = (handlerOffsetX.value / size) % length;\n        const i =\n            handlerOffsetX.value <= 0\n                ? Math.abs(toInt)\n                : Math.abs(toInt > 0 ? length - toInt : 0);\n        index.value = i;\n        const _sharedIndex = convertToSharedIndex(i);\n        sharedIndex.current = _sharedIndex;\n        onChange(_sharedIndex);\n    }, [\n        length,\n        handlerOffsetX,\n        sharedPreIndex,\n        index,\n        size,\n        sharedIndex,\n        convertToSharedIndex,\n        onChange,\n    ]);\n\n    const getCurrentIndex = React.useCallback(() => {\n        return index.value;\n    }, [index]);\n\n    const canSliding = React.useCallback(() => {\n        return !disable;\n    }, [disable]);\n\n    const onScrollEnd = React.useCallback(() => {\n        opts.onScrollEnd?.();\n    }, [opts]);\n\n    const onScrollBegin = React.useCallback(() => {\n        opts.onScrollBegin?.();\n    }, [opts]);\n\n    const scrollWithSpring = React.useCallback(\n        (toValue: number, callback?: () => void) => {\n            return withSpring(\n                toValue,\n                { damping: 100 },\n                (isFinished: boolean) => {\n                    callback?.();\n                    if (isFinished) {\n                        runOnJS(onScrollEnd)();\n                    }\n                }\n            );\n        },\n        [onScrollEnd]\n    );\n\n    const next = React.useCallback(() => {\n        if (!canSliding() || (!loop && index.value === length - 1)) return;\n\n        onScrollBegin?.();\n\n        const currentPage = Math.round(handlerOffsetX.value / size);\n\n        handlerOffsetX.value = scrollWithSpring((currentPage - 1) * size);\n    }, [\n        canSliding,\n        loop,\n        index.value,\n        length,\n        onScrollBegin,\n        handlerOffsetX,\n        size,\n        scrollWithSpring,\n    ]);\n\n    const prev = React.useCallback(() => {\n        if (!canSliding() || (!loop && index.value === 0)) return;\n\n        onScrollBegin?.();\n\n        const currentPage = Math.round(handlerOffsetX.value / size);\n\n        handlerOffsetX.value = scrollWithSpring((currentPage + 1) * size);\n    }, [\n        canSliding,\n        loop,\n        index.value,\n        onScrollBegin,\n        handlerOffsetX,\n        size,\n        scrollWithSpring,\n    ]);\n\n    const to = React.useCallback(\n        (idx: number, animated: boolean = false) => {\n            if (idx === index.value) return;\n            if (!canSliding()) return;\n\n            onScrollBegin?.();\n\n            const offset = handlerOffsetX.value + (index.value - idx) * size;\n\n            if (animated) {\n                handlerOffsetX.value = scrollWithSpring(offset, () => {\n                    index.value = idx;\n                });\n            } else {\n                handlerOffsetX.value = offset;\n                index.value = idx;\n                runOnJS(onScrollEnd)();\n            }\n        },\n        [\n            index,\n            canSliding,\n            onScrollBegin,\n            handlerOffsetX,\n            size,\n            scrollWithSpring,\n            onScrollEnd,\n        ]\n    );\n\n    return {\n        next,\n        prev,\n        to,\n        index,\n        length,\n        sharedIndex,\n        sharedPreIndex,\n        computedIndex,\n        getCurrentIndex,\n    };\n}\n"]}